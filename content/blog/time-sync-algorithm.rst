网络游戏时间同步问题
####################

:date: 2022-03-16 17:31
:category: game-dev 
:tags: time-sync
:slug: time-sync-algorithm


UDP
--------------

UDP协议的数据包误差小,因此它的同步方案比较简单:

1. client发送一个数据包给server,里面记录发送时间c1
2. server收到后,立刻给这个数据包添加一个server当前的时刻信息s1,并还给client 
3. client收到server返还的数据包后,记录当前时间c2
4. 整个行程的时间为 rt = c2 - c1
5. 假设数据包的来回时间相同,那么client的server时间为 s3 = s1 + (rt/2)


TCP
--------------

TCP协议的数据包,会因为丢包重发而引起较大误差,因此同步方式会比UDP复杂


1. 同UDP协议方式获取rt
2. client重复获取rt五次或更多次,每次暂停几秒
3. 结果按最低rt到最高rt的顺序累积和排序.通过从这个有序列表中选择中点样本来确定中值rt
4. 丢弃与中位数相差约1个标准差的所有样本,并使用算术平均值对剩余样本求平均值
